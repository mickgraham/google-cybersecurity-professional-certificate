# Module 4: Network Traffic and Logs Using IDS and SIEM Tools

## Overview

* Read and analyse logs
* Interpret signatures
* Search in SIEM tools

## Log Components and Formats

Logs provide visibility into network activity and are crucial for security professionals to detect unusual or malicious activity and investigate incidents. Originally, they served the sole purpose of troubleshooting common technology issues. For example, error logs provide information about why an unexpected error occurred and help to identify the root cause of the error so that it can be fixed. Today, virtually all computing devices produce some form of logs that provide valuable insights beyond troubleshooting.

Security professionals use logs to perform log analysis, which is the process of examining logs to identify events of interest. Logs help uncover the details surrounding the 5 W's of incident investigation: who triggered the incident, what happened, when the incident took place, where the incident took place, and why the incident occurred.

* **Common Log Types:** include network logs (from devices like firewalls), system logs (from operating systems), application logs (from software applications), security logs (from antivirus software), and authentication logs (for login attempts).
* **Log Content and Verbosity:** provide crucial details like timestamps, IP addresses, event descriptions, actions taken, and who performed them.

Common Log Formats:

* **Syslog:** This format acts as both a protocol for transporting logs and a structure for log entries, comprising a header, structured data, and a message.
* **JSON (JavaScript Object Notation):** A text-based easy-to-read format that organises data using key-value pairs.
* **XML (eXtensible Markup Language):** Uses tags and other keys to structure data to transport structured data.
* **CSV (Comma Separated Values):** A simple format that uses commas to distinguish different data values.
* **CEF (Common Event Format)** Uses key-value pairs with fields separated by a pipe character and extensions containing additional key-value pairs.

## Interpret signatures

An **intrusion detection system (IDS)** is an application that monitors system activity and alerts on possible intrusions. IDS technologies help organizations monitor the activity that happens on their systems and networks to identify indications of malicious activity.

A **host-based intrusion detection system (HIDS)** is an application that monitors the activity of the host on which it's installed. A HIDS is installed as an agent on a host. A host is also known as an endpoint, which is any device connected to a network like a computer or a server.

A **network-based intrusion detection system (NIDS)** is an application that collects and monitors network traffic and network data. NIDS software is installed on devices located at specific parts of the network that you want to monitor. The NIDS application inspects network traffic from different devices on the network. If any malicious network traffic is detected, the NIDS logs it and generates an alert.

### Detection techniques

**Detection** relies on data from various sources, including logs generated by different devices and telemetry from detection technologies.
**Telemetry** is the collection and transmission of data for analysis, while logs record events; for example, packet captures are a form of network telemetry.

* **Signature-based Analysis:** Detects known threats by comparing system activity against a database of predefined patterns (signatures) associated with malicious activity.
  * Advantages: Low rate of false positives.
  * Disadvantages: Signatures can be evaded, signatures require updates, inability to detect unknown threats.
* **Anomaly-based Analysis:** Establishes a baseline of normal system behaviour during a training phase and then flags any deviations from this baseline as abnormal.
  * Advantages: Ability to detect new and evolving threats.
  * Disadvantages: High rate of false positives, pre-existing compromise.

## Search in SIEM Tools

SIEM tools collect and analyse log data to monitor critical activities in an organization. They do this by collecting, analysing, and reporting on security data from multiple sources. The SIEM process for data collection involves the following steps:

* **Collect:** Collect and process is the step that involves the handling of an enormous amount of data generated by devices and systems from all over an environment.
* **Process:** Processing is the step where collected log data is parsed, filtered, and prepared.
* **Normalize:** Normalising is the step that makes raw data easy to read and analyze. It processes the raw data so that it is formatted consistently, and only relevant event information is included.
* **Index:** Indexing is the step that sorts data so it can be easily searched and accessed.

Data is required for SIEM tools to work effectively. SIEM tools must first collect data using **log ingestion**. Log ingestion is the process of collecting and importing data from log sources into a SIEM tool. Data comes from any source that generates log data, like a server. In log ingestion, the SIEM creates a copy of the event data it receives and retains it within its own storage. This copy allows the SIEM to analyze and process the data without directly modifying the original source logs.

A common way that organizations collect log data is to use **log forwarders**. Log forwarders are software that automate the process of collecting and sending log data.

### Suricata

Suricata is an open-source tool that functions as an intrusion detection system (IDS), intrusion prevention system (IPS), and network analysis tool. Rules, also known as signatures, are used to identify specific patterns of network traffic that may indicate malicious activity.

A Suricata signature consists of three main components: an **action** (e.g., alert, drop), a **header** (network traffic information), and **rule options** for customization. While Suricata offers pre-written rules, customising them is crucial to meet specific security requirements and minimise false positives.

### Splunk Search Processing Language (SPL)

* **Basic SPL Searches:** SPL is Splunk's querying language used to retrieve events from indexes. A basic search like `index=main fail` retrieves events containing the term "fail" from the "main" index.
* **Piping and Wildcards:** SPL uses the pipe character `|` to chain commands, allowing the output of one command to become the input for the next, enabling data refinement. Wildcards, typically `*`, expand search results by matching any character, useful for finding similar but not identical data (e.g., `fail*` matches "failed" or "failure").

### Google Security Operations (Chronicle) Searches

* **Unified Data Model (UDM) Search:** This is the default search type in Google SecOps, searching through normalised and structured security data. UDM searches are faster and retrieve events formatted with UDM fields, such as `metadata.event_type = "USER_LOGIN"` to find user login events.
* **Raw Log Search:** When information isn't found through normalised data, a Raw Log Search can be performed on raw, unparsed logs. This method is slower but supports regular expressions for more specific pattern matching.

## Glossary: Network Traffic and Logs Using IDS and SIEM Tools

**Anomaly-based analysis:** A detection method that identifies abnormal behaviour

**Array:** A data type that stores data in a comma-separated ordered list

**Common Event Format (CEF):** A log format that uses key-value pairs to structure data and identify fields and their corresponding values

**Configuration file:** A file used to configure the settings of an application

**Endpoint:** Any device connected on a network

**Endpoint detection and response (EDR):** An application that monitors an endpoint for malicious activity

**False positive:** An alert that incorrectly detects the presence of a threat

**Host-based intrusion detection system (HIDS):** An application that monitors the activity of the host on which it's installed

**Intrusion detection systems (IDS):** An application that monitors system activity and alerts on possible intrusions

**Key-value pair:** A set of data that represents two linked items: a key, and its corresponding value

**Log:** A record of events that occur within an organization's systems

**Log analysis:** The process of examining logs to identify events of interest

**Log management:** The process of collecting, storing, analysing, and disposing of log data

**Logging:** The recording of events occurring on computer systems and networks

**Network-based intrusion detection system (NIDS):** An application that collects and monitors network traffic and network data

**Object:** A data type that stores data in a comma-separated list of key-value pairs

**Search Processing Language (SPL):** Splunk's query language

**Security information and event management (SIEM):** An application that collects and analyses log data to monitor critical activities in an organization

**Signature:** A pattern that is associated with malicious activity

**Signature analysis:** A detection method used to find events of interest

**Suricata:** An open-source intrusion detection system, intrusion prevention system, and network analysis tool

**Telemetry:** The collection and transmission of data for analysis

**Wildcard:** A special character that can be substituted with any other character

**YARA-L:** A computer language used to create rules for searching through ingested log data

**Zero-day:** An exploit that was previously unknown
